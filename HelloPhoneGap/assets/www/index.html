<html>
  <head>
    <title>Contact Example</title>

    <script type="text/javascript" charset="utf-8" src="cordova-1.7.0rc1.js"></script>
    <script type="text/javascript" charset="utf-8" src="jquery.js"></script>
    	    <!-- cordova facebook plugin -->
		<script src="cdv-plugin-fb-connect.js"></script>
	    <!-- facebook js sdk -->
		<script src="facebook_js_sdk.js"></script>
		
		<script src="smsplugin.js" type="text/javascript" />
        <script type="text/javascript">              
        function onDeviceReady () {
		var options = new ContactFindOptions();
		options.filter= ""; 
		options.multiple = true;
        var fields = ["birthday","displayName","phoneNumbers"];
        //navigator.contacts.find(fields, onSuccess, onError, options);
        //navigator.contacts.find(fields, onSuccess, onError);
	}
	
	function onSuccess(contacts) {
    alert(contacts.length);
    //$("#contacts").html("hello");
        for (var i=0; i<contacts.length; i++) {
            console.log("Display Name = " + contacts[i].birthday);     
            console.log(typeof(contacts[i].birthday));
            var x =   contacts[i].birthday;
            if(x != null){    
            
               for (var j=0; j<contacts[i].phoneNumbers.length; j++) {            
					$("#contacts").html($("#contacts").html() + "<br/>" + contacts[i].displayName + " " + contacts[i].birthday + " " + contacts[i].phoneNumbers[j].value);
					//alert(typeof(contacts[i].birthday));
					//messageSend(contacts[i].phoneNumbers[j].value);
				}
			
			}
		}
	}
    // onError: Failed to get the contacts
    //
    function onError(contactError) {
        alert('onError!');
    }
    
    function messageSend(x){
				alert('Phone: ' + x + ' Message: Happy Birthday from Kartik' );
				window.plugins.sms.send(x, "Happy Birthday from Kartik", 
                    function () { 
					   alert('Message sent successfully');	
				    },
    				function (e) {
    					alert('Message Failed:' + e);
    				}
				);
		    			        	
        }
        document.addEventListener("deviceready", onDeviceReady, false);
        </script>        
        <meta name="viewport" content= "width=device-width; height=device-height; user-scalable=no">              
	</head>
	<body>
		<div id="startPage" data-role="page" data-theme="a">
			<div data-role="header">
				<h1>SMS Demo</h1>
			</div>
			<div data-role="content">
				<label for="phone">Recipient Number:</label>
				<input type="tel" id="phone" name="phone" placeholder="SMS Number"/>
				<label for="message">Message:</label>
				<textarea id="message" name="message"></textarea>		
				<a href="#" id="send" data-role="button">Send</a>		
			</div>
		</div>
		<div id="contacts"></div>
		<button onclick="login()">Login</button>
		<button onclick="me()">Me</button>
		<!--<button onclick="getSession()">Get session</button>-->
		<button onclick="getLoginStatus()">Get login</button>
		<button onclick="logout()">Logout</button>
		<button onclick="facebookWallPost()">facebookWallPost</button>
		<button onclick="publishStoryFriend()">friendstory</button>
          <div id="data">loading ...</div>
        
        <!--<script src="http://localhost:8080/target/target-script-min.js#anonymous"></script>-->
        <div id="fb-root"></div>
        <script>
            
            if ((typeof cordova == 'undefined') && (typeof Cordova == 'undefined')) alert('Cordova variable does not exist. Check that you have included cordova.js correctly');
            if (typeof CDV == 'undefined') alert('CDV variable does not exist. Check that you have included cdv-plugin-fb-connect.js correctly');
            if (typeof FB == 'undefined') alert('FB variable does not exist. Check that you have included the Facebook JS SDK file.');
            
            FB.Event.subscribe('auth.login', function(response) {
                               alert('auth.login event');
                               });
            
            FB.Event.subscribe('auth.logout', function(response) {
                               alert('auth.logout event');
                               });
            
            FB.Event.subscribe('auth.sessionChange', function(response) {
                               alert('auth.sessionChange event');
                               });
            
            FB.Event.subscribe('auth.statusChange', function(response) {
                               alert('auth.statusChange event');
                               });
            
            /*function getSession() {
                alert("session: " + JSON.stringify(FB.getSession()));
            }
            */
            function getLoginStatus() {
                FB.getLoginStatus(function(response) {
                                  if (response.status == 'connected') {
                                  alert('logged in');
                                  } else {
                                  alert('not logged in');
                                  }
                                  });
            }
            var friendIDs = [];
			var fdata;
            function me() {
                FB.api('/me/friends', { fields: 'id, name, picture, birthday' },  function(response) {
                       if (response.error) {
                       alert(JSON.stringify(response.error));
                       } else {
                       var data = document.getElementById('data');
					   fdata=response.data;
					   console.log("fdata: "+fdata);
                       response.data.forEach(function(item) {
                                             var d = document.createElement('div');
                                             d.innerHTML = "<img src="+item.picture+"/>"+item.name + " " + item.birthday;
                                             data.appendChild(d);
                                             });
                       }
					var friends = response.data;
					console.log(friends.length); 
					for (var k = 0; k < friends.length && k < 200; k++) {
				        var friend = friends[k];
				        var index = 1;

				        friendIDs[k] = friend.id;
				        //friendsInfo[k] = friend;
					}
					console.log("friendId's: "+friendIDs);
                       });
            }
            
            function logout() {
                FB.logout(function(response) {
                          alert('logged out');
                          });
            }
            
            function login() {
                FB.login(
                         function(response) {
                         if (response.session) {
                         alert('logged in');
                         } else {
                         alert('not logged in');
                         }
                         },
                         { scope: "email,friends_birthday" }
                         );
            }
			
			
			function facebookWallPost() {
			    console.log('Debug 1');
				var params = {
				    method: 'feed',
				    name: 'Facebook Dialogs',
				    link: 'https://developers.facebook.com/docs/reference/dialogs/',
				    picture: 'http://fbrell.com/f8.jpg',
				    caption: 'Reference Documentation',
				    description: 'Dialogs provide a simple, consistent interface for applications to interface with users.'
				  };
				console.log(params);
			    FB.ui(params, function(obj) { console.log(obj);});
			}
            
			function publishStoryFriend() {
				randNum = Math.floor ( Math.random() * friendIDs.length ); 

				var friendID = friendIDs[randNum];
				if (friendID == undefined){
					alert('please click the me button to get a list of friends first');
				}else{
			    	console.log("friend id: " + friendID );
			        console.log('Opening a dialog for friendID: ', friendID);
			        var params = {
			        	method: 'feed',
			            to: friendID.toString(),
			            name: 'Facebook Dialogs',
			            link: 'https://developers.facebook.com/docs/reference/dialogs/',
			            picture: 'http://fbrell.com/f8.jpg',
			            caption: 'Reference Documentation',
			            description: 'Dialogs provide a simple, consistent interface for applications to interface with users.'
			     	};
					FB.ui(params, function(obj) { console.log(obj);});
			    }
			}
            
            document.addEventListener('deviceready', function() {
                                      try {
                                      alert('Device is ready! Make sure you set your app_id below this alert.');
                                      FB.init({ appId: "405651006145953", nativeInterface: CDV.FB, useCachedDialogs: false });
                                      document.getElementById('data').innerHTML = "";
                                      } catch (e) {
                                      alert(e);
                                      }
                                      }, false);
            </script>
        <div id="log"></div>
	</body>
</html>
